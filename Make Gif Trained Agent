from stable_baselines3.common.env_util import make_atari_env
from stable_baselines3.common.vec_env import VecFrameStack
from stable_baselines3 import PPO
import imageio
import numpy as np

env = make_atari_env('ALE/SpaceInvaders-v5', n_envs=1, seed=0)

env = VecFrameStack(env, n_stack=4)
model_dir = 'SpaceInvadersModels'
model = PPO.load('./train/best_model_1261568', env = env)

images = []
obs = model.env.reset()
img = model.env.render(mode='rgb_array')
episodes = 1
for ep in range(500):
    images.append(img)
    action, _ = model.predict(obs)
    obs, _, _ ,_ = model.env.step(action)
    img = model.env.render(mode='rgb_array')

imageio.mimsave('SpaceInvaders.gif', [np.array(img) for i, img in enumerate(images) if i%2 == 0], fps=20)
